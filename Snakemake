# python syntax
import os
from os import path
from glob import glob


GENOME_VER = "/home/mehtass/data/genome_data/ensemble_2013/Schizosaccharomyces_pombe_ensemble"
TOPHAT_VER = "tophat/2.0.9/bowtie2-2.2.0" # we freeze the version of tophat to this one.  If necessary we can change this to run the whole analysis again.

dirname_part_prog = TOPHAT_VER.replace( "/", "" ) # the output directory name will have the tophat version baked in for further reference.

sequence_files = glob( "sequence_files/*.fastq.gz" )
dirnames_base = [ a.split("/")[1].split("_")[0] for a in sequence_files ]

op_dirnames = ["alignment_files/"+a+"_"+dirname_part_prog for a in dirnames_base]

opnames_pos = [ fname+"_pos.bam" for fname in op_dirnames ] # all the positive strand bam files
opnames_neg = [ fname+"_neg.bam" for fname in op_dirnames ] # all the negative strand bam files

BAMFNAMES = [ fname for fname in opnames_pos + opnames_neg ]

###############################################
"""Debugging comments, we will remove them once we are done with them"""
print( sequence_files ) # for debugging
print( op_dirnames ) # for debugging
print( opnames_pos ) # for debugging
print( opnames_neg ) # for debugging
print( BAMFNAMES )   # for debuggin


### My rules
rule bai_files:
    params: batch = "-l nodes=1:gpfs"
    input: [ fname+".bai" for fname in opnames_pos + opnames_neg ]
    shell: "module load bamtools; bamtools index -in {bamfnames}"

rule bam_files:
    params: batch = "-l nodes=1:gpfs"
    input: sequence_files, TOPHAT_VER
    shell: """
        module load {tophat}; 
	tophat \
	-p 32 \
	--library-type fr-secondstrand \
	-r 250 \
	-i 40 \
	-I 900 \
	--microexon-search \
	-o {op_dirnames} \
	{genome_ver} \
	{sequence_files}
	"""







### Rules copied from Sean's files
## rule indexbam:
##     """Index a bam file using bamtools, creating .bam.bai"""
##     input: "{base}.bam"
##     output: "{base}.bam.bai"
##     params: batch = "-l nodes=1:gpfs"
##     threads = 1
##     shell: "module load bamtools; bamtools index -in {input}
## 
## 
## rule rnaalignment:
##     """Align the fastq files"""
##     input: 
